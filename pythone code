import requests
from bs4 import BeautifulSoup
import re
from flask import Flask, request, jsonify, render_template

app = Flask(__name__)

def scan_url(url):
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')
    forms = soup.find_all('form')
    
    vulnerabilities = []
    
    for form in forms:
        action = form.get('action')
        method = form.get('method', 'get').lower()
        
        inputs = form.find_all('input')
        data = {input_.get('name'): '' for input_ in inputs}
        
        # Test XSS
        xss_payloads = ["<script>alert(1)</script>", "<img src=x onerror=alert(1)>"]
        for payload in xss_payloads:
            test_data = data.copy()
            test_data[list(data.keys())[0]] = payload
            
            if method == 'post':
                test_response = requests.post(action, data=test_data)
            else:
                test_response = requests.get(action, params=test_data)
                
            if payload in test_response.text:
                vulnerabilities.append({
                    'type': 'XSS',
                    'url': url,
                    'payload': payload,
                    'severity': 'High'
                })
        
        # Test SQLi
        sqli_payloads = ["' OR '1'='1", "admin' --", "1; DROP TABLE users"]
        for payload in sqli_payloads:
            test_data = data.copy()
            test_data[list(data.keys())[0]] = payload
            
            if method == 'post':
                test_response = requests.post(action, data=test_data)
            else:
                test_response = requests.get(action, params=test_data)
                
            if 'error' in test_response.text.lower() or 'syntax' in test_response.text.lower():
                vulnerabilities.append({
                    'type': 'SQL Injection',
                    'url': url,
                    'payload': payload,
                    'severity': 'Critical'
                })
    
    return vulnerabilities

@app.route('/')
def index():
    return render_template('one.html')

@app.route('/scan', methods=['POST'])
def scan():
    url = request.form.get('url')
    if not url:
        return jsonify({'error': 'URL is required'}), 400
    
    vulnerabilities = scan_url(url)
    return render_template('two.html', vulnerabilities=vulnerabilities, url=url)

if __name__ == '__main__':
    app.run(debug=True)
